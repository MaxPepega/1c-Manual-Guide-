# 1c-Manual-Guide-
1c Manual/Guide 

Тут написан код к модулям, возможно и к формам 

#####################################################################################
Приходная накладная

		Если ТекСтрокаСписокНоменклатуры.Номенклатура.Услуга = Перечисления.ВидыНоменклатуры.Услуга Тогда 
			Продолжить;
		КонецЕсли;
    
    
 ####################################################################################
 Приходная накладная форма документа 
 
 
&НаКлиенте
Процедура СписокНоменклатурыКоличествоПриИзменении(Элемент)
	СтрокаТЧ = Элементы.СписокНоменклатуры.ТекущиеДанные;
	СтрокаТЧ.Сумма = СтрокаТЧ.Колличество * СтрокаТЧ.Цена;
КонецПроцедуры

&НаКлиенте
Процедура СписокНоменклатурыЦенаПриИзменении(Элемент)
	СтрокаТЧ = Элементы.СписокНоменклатуры.ТекущиеДанные;
	СтрокаТЧ.Сумма = СтрокаТЧ.Колличество * СтрокаТЧ.Цена;
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	КонечнаяСумма = 0 ;
	Для каждого ТекСтрока из Объект.СписокНоменклатуры Цикл 
		КонечнаяСумма = КонечнаяСумма + ТекСтрока.Сумма;
	КонецЦикла;
	Объект.СуммаПоДокументу = КонечнаяСумма;
КонецПроцедуры
##########################################################################################

Расходная накладная форма документа 


&НаКлиенте
Процедура СписокНоменклатурыЦенаПриИзменении(Элемент)
	СтрокаТЧ = Элементы.СписокНоменклатуры.ТекущиеДанные;
	СтрокаТЧ.Сумма = СтрокаТЧ.Колличество * СтрокаТЧ.Цена
КонецПроцедуры

&НаКлиенте
Процедура СписокНоменклатурыКоличествоПриИзменении(Элемент)
	СтрокаТЧ = Элементы.СписокНоменклатуры.ТекущиеДанные;
	СтрокаТЧ.Сумма = СтрокаТЧ.Колличество * СтрокаТЧ.Цена
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Объект.УчетнаяПолитика = РегистрыСведений.МетодСписанияТоваров.ПолучитьПоследнее(Объект.Дата).МетодСписания;
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
		КонечнаяСумма = 0 ;
	Для каждого ТекСтрока из Объект.СписокНоменклатуры Цикл 
		КонечнаяСумма = КонечнаяСумма + ТекСтрока.Сумма;
	КонецЦикла;
	Объект.СуммаПоДокументу = КонечнаяСумма;
КонецПроцедуры

########################################################################################################################

Расходная наклодная модуль документа




Процедура ОбработкаПроведения(Отказ, Режим)
	Если ПустаяСтрока(УчетнаяПолитика) Тогда
		Отказ = истина;
		Сообщить("Не установлен метод списания");
	КонецЕсли;
	Движения.ОстаткиНоменклатуры.Записывать = Истина;
	Движения.Продажи.Записывать = Истина;
	
	Движения.ОстаткиНоменклатуры.Записать();
	Движения.Продажи.Записать();
	      	//{{КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходнаяНакладнаяСписокНоменклатуры.Номенклатура КАК Номенклатура,
		|	СУММА(РасходнаяНакладнаяСписокНоменклатуры.Количество) КАК Количество,
		|	РасходнаяНакладнаяСписокНоменклатуры.Цена КАК Цена,
		|	СУММА(РасходнаяНакладнаяСписокНоменклатуры.Сумма) КАК Сумма
		|ПОМЕСТИТЬ ВТ
		|ИЗ
		|	Документ.РасходнаяНакладная.СписокНоменклатуры КАК РасходнаяНакладнаяСписокНоменклатуры
		|ГДЕ
		|	РасходнаяНакладнаяСписокНоменклатуры.Ссылка = &Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	РасходнаяНакладнаяСписокНоменклатуры.Номенклатура,
		|	РасходнаяНакладнаяСписокНоменклатуры.Цена
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Номенклатура
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТ.Номенклатура КАК Номенклатура,
		|	ВТ.Количество КАК КоличествоВДокументе,
		|	ВТ.Цена КАК Цена,
		|	ВТ.Сумма КАК СуммаВДокументе,
		|	ОстаткиНоменклатурыОстатки.Партия КАК Партия,
		|	ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
		|	ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток
		|ИЗ
		|	ВТ КАК ВТ
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(
		|				&МоментВремени,
		|				Номенклатура В
		|					(ВЫБРАТЬ
		|						ВТ.Номенклатура КАК Номенклатура
		|					ИЗ
		|						ВТ КАК ВТ)";
	Если Не Партия.Пустая() Тогда
		Запрос.Текст = Запрос.Текст + " И Партия = &Партия";
	КонецЕсли;
	Запрос.Текст = Запрос.Текст +
		") КАК ОстаткиНоменклатурыОстатки
		|		ПО ВТ.Номенклатура = ОстаткиНоменклатурыОстатки.Номенклатура
		|
		|УПОРЯДОЧИТЬ ПО
		|	ОстаткиНоменклатурыОстатки.Партия.МоментВремени ВОЗР
		|ИТОГИ
		|	МАКСИМУМ(КоличествоВДокументе),
		|	МАКСИМУМ(СуммаВДокументе),
		|	СУММА(КоличествоОстаток),
		|	СУММА(СуммаОстаток)
		|ПО
		|	Номенклатура";
	
	Запрос.УстановитьПараметр("МоментВремени", МоментВремени());
	Запрос.УстановитьПараметр("Ссылка", Ссылка);
	Если Не Партия.Пустая() Тогда
		Запрос.УстановитьПараметр("Партия", Партия);
	КонецЕсли;
	Если УчетнаяПолитика = Перечисления.УчетнаяПолитика.ЛИФО Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "ВОЗР", "УБЫВ");
	КонецЕсли;
	РезультатЗапроса = Запрос.Выполнить();
	ВыборкаНоменклатура = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаНоменклатура.Следующий() Цикл
		// Проверка нехватки товара
		Если НЕ ВыборкаНоменклатура.Номенклатура.Услуга И ВыборкаНоменклатура.КоличествоОстаток < ВыборкаНоменклатура.КоличествоВДокументе Тогда
			Сообщить("Нехватает товара: " + ВыборкаНоменклатура.Номенклатура + " в кол-ве " + (ВыборкаНоменклатура.КоличествоВДокументе - ВыборкаНоменклатура.КоличествоОстаток));
			Отказ = Истина;
		КонецЕсли;
		Если Отказ Тогда
			Продолжить;
		КонецЕсли;
		ОсталосьСписать = ВыборкаНоменклатура.КоличествоВДокументе; 
		ВыборкаДетальныеЗаписи = ВыборкаНоменклатура.Выбрать();
		Пока ВыборкаДетальныеЗаписи.Следующий() И ОсталосьСписать <> 0 Цикл
			Если НЕ ВыборкаНоменклатура.Номенклатура.Услуга Тогда
				
				КСписанию = Мин(ОсталосьСписать, ВыборкаДетальныеЗаписи.КоличествоОстаток);
				СуммаСписания = ?(ВыборкаДетальныеЗаписи.КоличествоОстаток = КСписанию, ВыборкаДетальныеЗаписи.СуммаОстаток, ВыборкаДетальныеЗаписи.СуммаОстаток 
				/ ВыборкаДетальныеЗаписи.КоличествоОстаток * КСписанию);
				
				НовоеДвижение = Движения.ОстаткиНоменклатуры.ДобавитьРасход();
				НовоеДвижение.Период = Дата;
				НовоеДвижение.Регистратор = Ссылка;
				НовоеДвижение.Количество = КСписанию;
				НовоеДвижение.Номенклатура = ВыборкаДетальныеЗаписи.Номенклатура;					
				НовоеДвижение.Партия = ВыборкаДетальныеЗаписи.Партия;
				НовоеДвижение.Сумма = СуммаСписания;
			КонецЕсли;
			
			НовоеДвижение = Движения.Продажи.Добавить();
			НовоеДвижение.Активность = Истина;
			НовоеДвижение.Период = Дата;
			НовоеДвижение.Регистратор = Ссылка;
			НовоеДвижение.Номенклатура = ВыборкаДетальныеЗаписи.Номенклатура;
			НовоеДвижение.Сумма = КСписанию * ВыборкаДетальныеЗаписи.Цена;
			
			Если НовоеДвижение.Номенклатура.Услуга Тогда
				НовоеДвижение.Себестоимость = 0;
				НовоеДвижение.Количество = ВыборкаНоменклатура.КоличествоВДокументе;
			Иначе
				НовоеДвижение.Количество = КСписанию;
				НовоеДвижение.Себестоимость = СуммаСписания;
				ОсталосьСписать = ОсталосьСписать - КСписанию;
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
	
	//}}КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА

КонецПроцедуры

 
 
